Contents of the file: /webgame-platform/src/routes/upload.ts

import express from 'express';
import multer from 'multer';
import fs from 'fs';
import path from 'path';
import unzipper from 'unzipper';
import { v4 as uuidv4 } from 'uuid';

const router = express.Router();
const upload = multer({ dest: 'uploads/' });

router.post('/upload', upload.single('gameZip'), async (req, res) => {
    if (!req.file) {
        return res.status(400).send('No file uploaded.');
    }

    const gameId = uuidv4();
    const gamePath = path.join(__dirname, '../../uploads', gameId);

    try {
        fs.mkdirSync(gamePath, { recursive: true });

        fs.createReadStream(req.file.path)
            .pipe(unzipper.Extract({ path: gamePath }))
            .on('close', () => {
                fs.unlinkSync(req.file.path); // Remove the zip file after extraction
                res.status(200).send({ message: 'Game uploaded successfully', gameId });
            });
    } catch (error) {
        res.status(500).send('Error processing the file.');
    }
});

export default router;

Contents of the file: /webgame-platform/src/routes/games.ts

import express from 'express';
import sqlite3 from 'sqlite3';
import path from 'path';

const router = express.Router();
const db = new sqlite3.Database(path.join(__dirname, '../../data/games.db'));

router.get('/games', (req, res) => {
    db.all('SELECT * FROM games', [], (err, rows) => {
        if (err) {
            return res.status(500).send('Error retrieving games.');
        }
        res.status(200).json(rows);
    });
});

router.get('/games/:id', (req, res) => {
    const gameId = req.params.id;
    db.get('SELECT * FROM games WHERE id = ?', [gameId], (err, row) => {
        if (err || !row) {
            return res.status(404).send('Game not found.');
        }
        res.status(200).sendFile(path.join(__dirname, '../../uploads', gameId, 'index.html'));
    });
});

export default router;

Contents of the file: /webgame-platform/src/views/index.ejs

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game List</title>
</head>
<body>
    <h1>Game List</h1>
    <ul>
        <% games.forEach(function(game) { %>
            <li>
                <a href="/games/<%= game.id %>"><%= game.name %></a>
            </li>
        <% }); %>
    </ul>
    <form action="/upload" method="post" enctype="multipart/form-data">
        <input type="file" name="gameZip" accept=".zip" required>
        <button type="submit">Upload Game</button>
    </form>
</body>
</html>

Contents of the file: /webgame-platform/src/views/game.ejs

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= game.name %></title>
</head>
<body>
    <h1><%= game.name %></h1>
    <iframe src="/uploads/<%= game.id %>/index.html" width="800" height="600"></iframe>
    <a href="/">Back to Game List</a>
</body>
</html>